{
   "AWSTemplateFormatVersion":"2010-09-09",
   "Resources":{
      "IdentityPolicy":{
         "Type":"AWS::IAM::Policy",
         "Properties":{
            "PolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Action":[
                        "ec2:DescribeInstances",
                        "ec2:DescribeRegions",
                        "ec2:AllocateAddress",
                        "ec2:AssociateAddress",
                        "ec2:DescribeAddresses",
                        "ec2:DisassociateAddress",
                        "ec2:ReleaseAddress",
                        "elasticloadbalancing:DescribeInstanceHealth",
                        "elasticloadbalancing:DescribeLoadBalancers"
                     ],
                     "Resource":[
                        "*"
                     ],
                     "Effect":"Allow"
                  },
                  {
                     "Action":[
                        "s3:ListBucket"
                     ],
                     "Effect":"Allow",
                     "Resource":[
                        "arn:aws:s3:::mozilla-identity-us-standard"
                     ]
                  },
                  {
                     "Action":[
                        "s3:GetObject"
                     ],
                     "Effect":"Allow",
                     "Resource":[
                        "arn:aws:s3:::mozilla-identity-us-standard/*"
                     ]
                  }
               ]
            },
            "PolicyName":"identity",
            "Roles":[
               { "Ref": "IdentityAdminStageRole" },
               { "Ref": "IdentityBridgeGmailStageRole" },
               { "Ref": "IdentityBridgeYahooStageRole" },
               { "Ref": "IdentityDbmasterStageRole" },
               { "Ref": "IdentityDbreadStageRole" },
               { "Ref": "IdentityDbwriteStageRole" },
               { "Ref": "IdentityGraphiteStageRole" },
               { "Ref": "IdentityKeysignStageRole" },
               { "Ref": "IdentityMetricsStageRole" },
               { "Ref": "IdentityMonitorStageRole" },
               { "Ref": "IdentityProxyStageRole" },
               { "Ref": "IdentityRootzoneStageRole" },
               { "Ref": "IdentityWebheadStageRole" },
               { "Ref": "IdentityBuilderStageRole" },
               { "Ref": "IdentityAdminProdRole" },
               { "Ref": "IdentityBridgeGmailProdRole" },
               { "Ref": "IdentityBridgeYahooProdRole" },
               { "Ref": "IdentityDbmasterProdRole" },
               { "Ref": "IdentityDbreadProdRole" },
               { "Ref": "IdentityDbwriteProdRole" },
               { "Ref": "IdentityGraphiteProdRole" },
               { "Ref": "IdentityKeysignProdRole" },
               { "Ref": "IdentityMetricsProdRole" },
               { "Ref": "IdentityMonitorProdRole" },
               { "Ref": "IdentityProxyProdRole" },
               { "Ref": "IdentityRootzoneProdRole" },
               { "Ref": "IdentityWebheadProdRole" },
               { "Ref": "IdentityBuilderProdRole" }
            ]
         },
         "DependsOn" : [
           "IdentityAdminStageRole",
           "IdentityBridgeGmailStageRole",
           "IdentityBridgeYahooStageRole",
           "IdentityDbmasterStageRole",
           "IdentityDbreadStageRole",
           "IdentityDbwriteStageRole",
           "IdentityGraphiteStageRole",
           "IdentityKeysignStageRole",
           "IdentityMetricsStageRole",
           "IdentityMonitorStageRole",
           "IdentityProxyStageRole",
           "IdentityRootzoneStageRole",
           "IdentityWebheadStageRole",
           "IdentityBuilderStageRole",
           "IdentityAdminProdRole",
           "IdentityBridgeGmailProdRole",
           "IdentityBridgeYahooProdRole",
           "IdentityDbmasterProdRole",
           "IdentityDbreadProdRole",
           "IdentityDbwriteProdRole",
           "IdentityGraphiteProdRole",
           "IdentityKeysignProdRole",
           "IdentityMetricsProdRole",
           "IdentityMonitorProdRole",
           "IdentityProxyProdRole",
           "IdentityRootzoneProdRole",
           "IdentityWebheadProdRole",
           "IdentityBuilderProdRole"
         ]
      },
      "IdentityAdminPolicy":{
         "Type":"AWS::IAM::Policy",
         "Properties":{
            "PolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Action":[
                        "elasticloadbalancing:DeregisterInstancesFromLoadBalancer",
                        "elasticloadbalancing:DescribeInstanceHealth",
                        "elasticloadbalancing:DescribeLoadBalancers",
                        "elasticloadbalancing:RegisterInstancesWithLoadBalancer"
                     ],
                     "Resource":[
                        "*"
                     ],
                     "Effect":"Allow"
                  }
               ]
            },
            "PolicyName":"identity-admin",
            "Roles":[
               { "Ref": "IdentityAdminStageRole" },
               { "Ref": "IdentityAdminProdRole" }
            ]
         },
         "DependsOn": [
            "IdentityAdminStageRole",
            "IdentityAdminProdRole"
         ]
      },
      "IdentityGraphitePolicy":{
         "Type":"AWS::IAM::Policy",
         "Properties":{
            "PolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Action":[
                        "cloudwatch:DescribeAlarmHistory",
                        "cloudwatch:DescribeAlarms",
                        "cloudwatch:DescribeAlarmsForMetric",
                        "cloudwatch:GetMetricStatistics",
                        "cloudwatch:ListMetrics",
                        "elasticloadbalancing:DescribeLoadBalancers"
                     ],
                     "Resource":[
                        "*"
                     ],
                     "Effect":"Allow"
                  }
               ]
            },
            "PolicyName":"identity-graphite",
            "Roles":[
               { "Ref": "IdentityGraphiteStageRole" },
               { "Ref": "IdentityGraphiteProdRole" }
            ]
         },
         "DependsOn": [
             "IdentityGraphiteStageRole",
             "IdentityGraphiteProdRole"
         ]
      },
      "IdentityBuilderProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityBuilderProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.admin.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.bridge-gmail.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.bridge-yahoo.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbmaster.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbread.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbwrite.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.graphite.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.keysign.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.metrics.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.monitor.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.proxy.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.rootzone.prod.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.webhead.prod.*"
                           ],
                           "Action":[
                              "S3:PutObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "*"
                           ],
                           "Action":[
                              "ec2:DescribeVpcs",
                              "ec2:DescribeSecurityGroups",
                              "ec2:DescribeSubnets",
                              "iam:ListServerCertificates",
                              "cloudformation:ListStackResources",
                              "autoscaling:DescribeAutoScalingGroups",
                              "autoscaling:DescribeLaunchConfigurations"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "*"
                           ],
                           "Action":[
                              "elasticloadbalancing:CreateLoadBalancer",
                              "elasticloadbalancing:ConfigureHealthCheck",
                              "autoscaling:CreateLaunchConfiguration",
                              "autoscaling:CreateAutoScalingGroup",
                              "elasticloadbalancing:CreateLoadBalancerPolicy",
                              "elasticloadbalancing:SetLoadBalancerPoliciesOfListener",
                              "iam:PassRole",
                              "autoscaling:CreateOrUpdateTags",
                              "autoscaling:SetDesiredCapacity"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "*"
                           ],
                           "Action":[
                              "cloudwatch:DeleteAlarms",
                              "autoscaling:DeleteLaunchConfiguration",
                              "autoscaling:DeleteAutoScalingGroup",
                              "elasticloadbalancing:DeleteLoadBalancer",
                              "autoscaling:UpdateAutoScalingGroup"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityBuilderProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityBuilderProdRole"
               }
            ]
         }
      },
      "IdentityBuilderStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityBuilderStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.admin.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.bridge-gmail.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.bridge-yahoo.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbmaster.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbread.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbwrite.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.graphite.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.keysign.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.metrics.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.monitor.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.proxy.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.rootzone.stage.*",
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.webhead.stage.*"
                           ],
                           "Action":[
                              "S3:PutObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "*"
                           ],
                           "Action":[
                              "ec2:DescribeVpcs",
                              "ec2:DescribeSecurityGroups",
                              "ec2:DescribeSubnets",
                              "iam:ListServerCertificates",
                              "cloudformation:ListStackResources",
                              "autoscaling:DescribeAutoScalingGroups",
                              "autoscaling:DescribeLaunchConfigurations"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "*"
                           ],
                           "Action":[
                              "elasticloadbalancing:CreateLoadBalancer",
                              "elasticloadbalancing:ConfigureHealthCheck",
                              "autoscaling:CreateLaunchConfiguration",
                              "autoscaling:CreateAutoScalingGroup",
                              "elasticloadbalancing:CreateLoadBalancerPolicy",
                              "elasticloadbalancing:SetLoadBalancerPoliciesOfListener",
                              "iam:PassRole",
                              "autoscaling:CreateOrUpdateTags",
                              "autoscaling:SetDesiredCapacity"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "*"
                           ],
                           "Action":[
                              "cloudwatch:DeleteAlarms",
                              "autoscaling:DeleteLaunchConfiguration",
                              "autoscaling:DeleteAutoScalingGroup",
                              "elasticloadbalancing:DeleteLoadBalancer",
                              "autoscaling:UpdateAutoScalingGroup"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityBuilderStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityBuilderStageRole"
               }
            ]
         }
      },
      "IdentityAdminStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityAdminStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.admin.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityAdminStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityAdminStageRole"
               }
            ]
         }
      },
      "IdentityBridgeGmailStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityBridgeGmailStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.bridge-gmail.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityBridgeGmailStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityBridgeGmailStageRole"
               }
            ]
         }
      },
      "IdentityBridgeYahooStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityBridgeYahooStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.bridge-yahoo.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityBridgeYahooStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityBridgeYahooStageRole"
               }
            ]
         }
      },
      "IdentityDbmasterStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityDbmasterStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbmaster.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityDbmasterStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityDbmasterStageRole"
               }
            ]
         }
      },
      "IdentityDbreadStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityDbreadStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbread.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityDbreadStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityDbreadStageRole"
               }
            ]
         }
      },
      "IdentityDbwriteStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityDbwriteStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbwrite.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityDbwriteStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityDbwriteStageRole"
               }
            ]
         }
      },
      "IdentityGraphiteStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityGraphiteStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.graphite.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityGraphiteStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityGraphiteStageRole"
               }
            ]
         }
      },
      "IdentityKeysignStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityKeysignStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.keysign.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityKeysignStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityKeysignStageRole"
               }
            ]
         }
      },
      "IdentityMetricsStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityMetricsStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.metrics.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityMetricsStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityMetricsStageRole"
               }
            ]
         }
      },
      "IdentityMonitorStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityMonitorStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.monitor.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityMonitorStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityMonitorStageRole"
               }
            ]
         }
      },
      "IdentityProxyStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityProxyStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.proxy.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityProxyStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityProxyStageRole"
               }
            ]
         }
      },
      "IdentityRootzoneStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityRootzoneStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.rootzone.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityRootzoneStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityRootzoneStageRole"
               }
            ]
         }
      },
      "IdentityWebheadStageRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityWebheadStagePolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.webhead.stage.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityWebheadStage":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityWebheadStageRole"
               }
            ]
         }
      },
      "IdentityAdminProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityAdminProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.admin.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityAdminProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityAdminProdRole"
               }
            ]
         }
      },
      "IdentityBridgeGmailProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityBridgeGmailProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.bridge-gmail.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityBridgeGmailProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityBridgeGmailProdRole"
               }
            ]
         }
      },
      "IdentityBridgeYahooProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityBridgeYahooProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.bridge-yahoo.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityBridgeYahooProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityBridgeYahooProdRole"
               }
            ]
         }
      },
      "IdentityDbmasterProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityDbmasterProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbmaster.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityDbmasterProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityDbmasterProdRole"
               }
            ]
         }
      },
      "IdentityDbreadProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityDbreadProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbread.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityDbreadProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityDbreadProdRole"
               }
            ]
         }
      },
      "IdentityDbwriteProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityDbwriteProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.dbwrite.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityDbwriteProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityDbwriteProdRole"
               }
            ]
         }
      },
      "IdentityGraphiteProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityGraphiteProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.graphite.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityGraphiteProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityGraphiteProdRole"
               }
            ]
         }
      },
      "IdentityKeysignProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityKeysignProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.keysign.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityKeysignProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityKeysignProdRole"
               }
            ]
         }
      },
      "IdentityMetricsProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityMetricsProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.metrics.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityMetricsProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityMetricsProdRole"
               }
            ]
         }
      },
      "IdentityMonitorProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityMonitorProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.monitor.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityMonitorProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityMonitorProdRole"
               }
            ]
         }
      },
      "IdentityProxyProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityProxyProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.proxy.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityProxyProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityProxyProdRole"
               }
            ]
         }
      },
      "IdentityRootzoneProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityRootzoneProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.rootzone.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityRootzoneProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityRootzoneProdRole"
               }
            ]
         }
      },
      "IdentityWebheadProdRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "ec2.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Path":"/",
            "Policies":[
               {
                  "PolicyName":"IdentityWebheadProdPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets"
                           ],
                           "Action":[
                              "S3:ListBucket",
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        },
                        {
                           "Resource":[
                              "arn:aws:s3:::net.mozaws.ops.hiera-secrets/type/persona.webhead.prod.*"
                           ],
                           "Action":[
                              "S3:GetObject"
                           ],
                           "Effect":"Allow"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "IdentityWebheadProd":{
         "Type":"AWS::IAM::InstanceProfile",
         "Properties":{
            "Path":"/identity/",
            "Roles":[
               {
                  "Ref":"IdentityWebheadProdRole"
               }
            ]
         }
      }
   }
}